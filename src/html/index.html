<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Using TheMovieDB</title>
    <meta name="viewport" content="width=device-width">
    <!-- API version 3 documentation: 
        https://developers.themoviedb.org/3/search
        https://developers.themoviedb.org/3/movies
    -->
</head>
<body>
    <h1>Using TheMovieDB.org API v3</h1>
    <p><img id="poster" alt="Jaws"/></p>
    <div><p id="secure_base_url"></p></div>
    <div><p id="config_data"></p></div>
    <div id="output">
        <!-- output will go here -->
    </div>
    
    <script>
        /*************
        SAMPLE URLS
        
        1. Ottenere dati di configurazione come l'URL di base per prelevare le immagini
        https://api.themoviedb.org/3/configuration?api_key=<APIKEY>
        
        2. Prelevare una lista di film in base a una keyword
        https://api.themoviedb.org/3/search/movie?api_key=<APIKEY>&query=<keyword>
        
        3. Prelevare più info su un particolare film di cui si conosce l'id
        https://api.themoviedb.org/3/movie/<movie-id>?api_key=<APIKEY>
        *************/
        const APIKEY = 'd278f4116f977c4c40da51f004832a5a';
        let baseURL = 'https://api.themoviedb.org/3/';
        let configData = null;
        let baseImageURL = null;
        
        let getConfig = function () {
            let url = "".concat(baseURL, 'configuration?api_key=', APIKEY); /* con questo URL otteniamo il file di configurazione */
            fetch(url)
            .then((result)=>{
                return result.json();
            })
            .then((data)=>{ /* 'data' è tutto l'oggetto JSON restituito dall'API */
                baseImageURL = data.images.secure_base_url; /* secure usa l'https */
                document.getElementById('secure_base_url').innerHTML = baseImageURL;
                configData = data.images;
                document.getElementById('config_data').innerHTML = JSON.stringify(configData.poster_sizes);
                console.log('config:', data); /* tutto l'oggetto JSON viene stampato nella console */
                console.log('il file config è stato prelevato');
                runSearch('jaws')
            })
            .catch(function(err){
                alert(err);
            });
        }
        
        let runSearch = function (keyword) {
            let url = ''.concat(baseURL, 'search/movie?api_key=', APIKEY, '&query=', keyword); // con questo URL otteniamo i risultati di una ricerca per keyword
            fetch(url)
            .then(result=>result.json())
            .then((data)=>{
                document.getElementById('output').innerHTML = JSON.stringify(data, null, 4);
                //qui si può lavorare ulteriormente con l'array di results ottenuto; nella riga sopra viene banalmente stampato nel documento HTML
                document.getElementById('poster').src = baseImageURL.concat('w185', data.results[0].poster_path);
            })
        }
        
        document.addEventListener('DOMContentLoaded', getConfig); // appena carica il documento esegue la funzione getConfig
        /*******************************
        ESEMPIO DI DATI RESTITUITI DAL METODO SEARCH
        { "vote_count": 2762, 
            "id": 578, 
            "video": false, 
            "vote_average": 7.5, 
            "title": "Jaws", 
            "popularity": 16.273358, 
            "poster_path": "/l1yltvzILaZcx2jYvc5sEMkM7Eh.jpg", 
            "original_language": "en", 
            "original_title": "Jaws", 
            "genre_ids": [ 27, 53, 12 ], 
            "backdrop_path": "/slkPgAt1IQgxZXNrazEcOzhAK8f.jpg", 
            "adult": false, 
            "overview": "An insatiable great white shark terrorizes the townspeople of Amity Island, The police chief, an oceanographer and a grizzled shark hunter seek to destroy the bloodthirsty beast.", 
            "release_date": "1975-06-18" 
        }
        *******************************/
    </script>
</body>
</html>